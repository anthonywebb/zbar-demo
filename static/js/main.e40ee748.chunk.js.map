{"version":3,"sources":["index.js"],"names":["handleResize","width","document","documentElement","clientWidth","height","clientHeight","video","getElementById","canvas","videoWidth","videoHeight","style","init","a","window","onresize","navigator","mediaDevices","getUserMedia","audio","facingMode","max","mediaStream","srcObject","play","Promise","r","onloadedmetadata","render","symbols","footer","ctx","getContext","clearRect","firstChild","removeChild","lastChild","font","strokeStyle","fillStyle","lineWidth","i","length","sym","points","beginPath","j","x","y","moveTo","lineTo","closePath","stroke","fillText","div","createElement","className","innerText","typeName","decode","appendChild","scan","drawImage","imgData","getImageData","scanImageData","res","sleep","ms","setTimeout","body","console","error","main"],"mappings":"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","file":"static/js/main.e40ee748.chunk.js","sourcesContent":["import React from 'react';\r\nimport {scanImageData} from 'zbar.wasm';\r\n\r\nconst SCAN_PROID_MS = 800;\r\n\r\nconst handleResize = () => {\r\n  const width = document.documentElement.clientWidth;\r\n  const height = document.documentElement.clientHeight;\r\n  const video = document.getElementById('video');\r\n  video.width = width;\r\n  video.height = height;\r\n\r\n  const canvas = document.getElementById('canvas');\r\n  canvas.width = video.videoWidth;\r\n  canvas.height = video.videoHeight;\r\n  if (width * video.videoHeight < height * video.videoWidth) {\r\n    canvas.style.width = '100vw';\r\n    canvas.style.height = 'auto';\r\n  } else {\r\n    canvas.style.width = 'auto';\r\n    canvas.style.height = '100vh';\r\n  }\r\n};\r\n\r\nconst init = async () => {\r\n  window.onresize = handleResize;\r\n  const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n    audio: false,\r\n    video: {\r\n      facingMode: 'environment',\r\n      width: {max: 640},\r\n      height: {max: 640}\r\n    }\r\n  });\r\n  const video = document.getElementById('video');\r\n  video.srcObject = mediaStream;\r\n  video.play();\r\n  await new Promise(r => {\r\n    video.onloadedmetadata = r;\r\n  });\r\n  handleResize();\r\n};\r\n\r\nconst render = (symbols) => {\r\n  const canvas = document.getElementById('canvas');\r\n  const footer = document.getElementById('footer');\r\n  const ctx = canvas.getContext('2d');\r\n  const width = canvas.width;\r\n  const height = canvas.height;\r\n  ctx.clearRect(0, 0, width, height);\r\n  while (footer.firstChild) {\r\n    footer.removeChild(footer.lastChild);\r\n  }\r\n  ctx.font = '20px serif';\r\n  ctx.strokeStyle = '#00ff00';\r\n  ctx.fillStyle = '#ff0000';\r\n  ctx.lineWidth = 6;\r\n  for (let i = 0; i < symbols.length; ++i) {\r\n    const sym = symbols[i];\r\n    const points = sym.points;\r\n    ctx.beginPath();\r\n    for (let j = 0; j < points.length; ++j) {\r\n      const {x, y} = points[j];\r\n      if (j === 0) {\r\n        ctx.moveTo(x, y);\r\n      } else {\r\n        ctx.lineTo(x, y);\r\n      }\r\n    }\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.fillText('#' + i, points[0].x, points[0].y - 10);\r\n\r\n    const div = document.createElement('div');\r\n    div.className = 'footerItem';\r\n    div.innerText = `#${i}: Type: ${sym.typeName}; Value: \"${sym.decode()}\"`\r\n    footer.appendChild(div);\r\n  }\r\n};\r\n\r\nconst scan = async () => {\r\n  const canvas = document.createElement('canvas');\r\n  const video = document.getElementById('video');\r\n  const width = video.videoWidth;\r\n  const height = video.videoHeight;\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  const ctx = canvas.getContext('2d');\r\n  ctx.drawImage(video, 0, 0, width, height);\r\n  const imgData = ctx.getImageData(0, 0, width, height);\r\n  const res = await scanImageData(imgData);\r\n  // console.log(res, Date.now());\r\n  render(res);\r\n};\r\n\r\nconst sleep = ms => new Promise(r => {\r\n  setTimeout(r, ms)\r\n});\r\n\r\nconst main = async () => {\r\n  try {\r\n    await init();\r\n    while (true) {\r\n      await scan();\r\n      await sleep(SCAN_PROID_MS);\r\n    }\r\n  } catch (err) {\r\n    const div = document.createElement('div');\r\n    div.className = 'full middle';\r\n    div.style = 'height: 72px; width: 100%; text-align: center; font-size: 36px';\r\n    div.innerText = 'Cannot get camera: ' + err;\r\n    document.body.appendChild(div);\r\n    console.error(err);\r\n  }\r\n};\r\n\r\nmain();\r\n"],"sourceRoot":""}